function DrawioViewer(d,c,b,a){this.id=c;this.diagramName=d;this.ceoId=b;this.options=a;mxResources.extension=".properties";mxResources.add(this.options.resourcePath);this.buttons=this.createButtons()}DrawioViewer.prototype.graph;DrawioViewer.prototype.id;DrawioViewer.prototype.toolbar;DrawioViewer.prototype.options;DrawioViewer.prototype.originX=0;DrawioViewer.prototype.originY=0;DrawioViewer.prototype.popupWindow;DrawioViewer.prototype.buttons={};DrawioViewer.prototype.installToolbar=function(){this.toolbar=document.createElement("div");var c=this.toolbar;var a=this.graph.container;c.id="diagramly-reader-toolbar-"+this.id;c.className="diagramly-reader-toolbar";a.parentNode.appendChild(c);c.style.position="absolute";var b=this.graph.getBorderSizes();c.style.bottom=(a.offsetTop+b.y)+5+"px";c.style.left=(a.offsetLeft+b.x)+"px";c.style.width=this.countVisibleButtons()*29+"px"};DrawioViewer.prototype.countVisibleButtons=function(){var a=0;for(var c in this.buttons){var b=this.buttons[c];if(b.visible){a++}}return a};DrawioViewer.prototype.init=function(){mxConstants.SHADOWCOLOR="#d0d0d0";this.graph.setEnabled(false);this.graph.container.style.overflow="hidden";this.graph.setPanning(true);this.graph.resizeContainer=false;this.graph.minFitScale=0;this.graph.maxFitScale=100;this.graph.panningHandler.ignoreCell=true;this.graph.cellRenderer.getLabelValue=function(b){var a=mxCellRenderer.prototype.getLabelValue.apply(this,arguments);if(b.view.graph.isHtmlLabel(b.cell)){if(b.style.html!=1){a=mxUtils.htmlEntities(a,false)}}return a};this.graph.click=function(d){var a=d.getCell();if(a!=null){var b=this.getLinkForCell(a);if(b!=null){var c=document.createElement("a");c.href=b;c.href=c.href;if(c.host==location.host){var e=AJS.Confluence.getContextPath();window.location.href=b.substring(0,e.length-1)==e?b:e+b}else{window.open(b)}}}};this.graph.setTooltips(!mxClient.IS_TOUCH);if(this.options.width!=null){this.graph.container.style.width=this.options.width+"px"}if(this.options.height!=null){this.graph.container.style.height=this.options.height+"px"}this.graph.container.style.border=this.options.border?"1px solid #DDDDDD":"none";this.graph.panningHandler.useLeftButtonForPanning=true;this.graph.selectOnPopup=false;this.loadStylesheet();if(mxClient.IS_TOUCH){mxPanningHandler.prototype.useLeftButtonForPanning=true;mxPanningHandler.prototype.isPanningTrigger=function(b){var a=b.getEvent();return(this.useLeftButtonForPanning&&(this.ignoreCell||b.getState()==null))||(mxEvent.isControlDown(a)&&mxEvent.isShiftDown(a))||(this.usePopupTrigger&&mxEvent.isPopupTrigger(a))}}mxEvent.disableContextMenu(this.graph.container)};DrawioViewer.prototype.postLoad=function(){var b=this.options.autoSize||this.options.width==null;var f=this.options.autoSize||this.options.height==null;var e=this.graph.getGraphBounds();var d=e.width/e.height;var c=b?e.width:this.options.width;var a=f?c/d+27:this.options.height;this.graph.container.style.width=c+"px";this.graph.container.style.height=a+"px";this.translateOrigin();this.graph.fit()};DrawioViewer.prototype.translateOrigin=function(){var a=this.graph.getGraphBounds();this.graph.view.setTranslate(this.originX-a.x,this.originY-a.y)};DrawioViewer.prototype.loadGraph=function(b,a){var d=null;try{d=this.createSpinner(this.graph.container);mxUtils.get(this.options.loadUrl,mxUtils.bind(this,function(f){if(f.getStatus()!=200){}else{var e=JSON.parse(f.getText());var g=mxUtils.parseXml(e.xml);this.xmlDoc=g;this.filename=e.filename;this.setGraphXml(this.graph,g.documentElement);this.postLoad()}d.stop()}),function(){d.stop()})}catch(c){d.stop()}};DrawioViewer.prototype.loadStylesheet=function(){var a=mxUtils.load(this.options.stylePath+"/default.xml").getDocumentElement();var b=new mxCodec(a.ownerDocument);b.decode(a,this.graph.getStylesheet())};DrawioViewer.prototype.renderButtons=function(){var e=this.graph;var a=this;var b=this.options;for(var d in this.buttons){var c=this.buttons[d];if(!c.visible){continue}this.addToolbarButton(this.toolbar,c)}};DrawioViewer.prototype.addToolbarButton=function(d,e){var b=typeof e.enabled==="undefined"?true:b;var c=e.linkButton?document.createElement("a"):document.createElement("div");c.className="diagramly-reader-toolbar-button";if(e.icon!=null){var a=document.createElement("img");a.setAttribute("src",e.icon);a.style.verticalAlign="middle";a.style.marginRight="2px";c.appendChild(a);c.title=e.label}if(!e.enabled){c.style.opacity=0.2}else{if(e.linkButton){c.href=e.url}else{mxEvent.addListener(c,"click",function(f){e.clickHandler.apply(this,arguments)})}mxEvent.addListener(c,"mouseover",function(f){c.className+=" diagramly-reader-toolbar-button-hover"});mxEvent.addListener(c,"mouseout",function(f){c.className="diagramly-reader-toolbar-button"})}d.appendChild(c);return c};DrawioViewer.prototype.setGraphXml=function(e,d){var h=new mxCodec(d.ownerDocument);if(d.nodeName=="mxGraphModel"){e.view.scale=Number(d.getAttribute("scale")||1);e.graphHandler.guidesEnabled=d.getAttribute("guides")!="0";e.setConnectable(d.getAttribute("connect")!="0");e.foldingEnabled=d.getAttribute("fold")!="0";e.scrollbars=d.getAttribute("scrollbars")!="0";if(!this.graph.scrollbars){e.container.scrollLeft=0;e.container.scrollTop=0;e.view.translate.x=Number(d.getAttribute("dx")||0);e.view.translate.y=Number(d.getAttribute("dy")||0)}e.pageVisible=d.getAttribute("page")=="1";e.pageBreaksVisible=e.pageVisible;e.preferPageSize=e.pageBreaksVisible;e.container.style.backgroundColor=d.getAttribute("background");var a=d.getAttribute("backgroundImage");if(a!=null){a=JSON.parse(a);this.graph.setBackgroundImage(new mxImage(a.src,a.width,a.height))}var g=d.getAttribute("pageScale");if(g!=null){e.pageScale=g}else{e.pageScale=1.5}var c=d.getAttribute("pageWidth");var f=d.getAttribute("pageHeight");if(c!=null&&f!=null){e.pageFormat=new mxRectangle(0,0,parseFloat(c),parseFloat(f))}var b=d.getAttribute("background");if(b!=null&&b.length>0){this.graph.background=b}e.pageVisible=false;e.pageBreaksVisible=false;h.decode(d,e.getModel())}};DrawioViewer.prototype.createSpinner=function(a){var b={lines:12,length:12,width:5,radius:10,rotate:0,color:"#000",speed:1,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000};return new Spinner(b).spin(a)};DrawioViewer.prototype.show=function(a){this.graph=new Graph(a);this.graph.id=this.id;this.init();this.loadGraph(this.diagramName,this.ceoId);if(this.options.viewerToolbar){this.installToolbar();this.renderButtons()}};DrawioViewer.prototype.createButtons=function(){var e=this;var d={};var c=typeof this.options.disableButtons==="undefined"?true:!this.options.disableButtons;var a=this.options.userCanEdit&&c;var b=this.options.userCanRemove&&c;d[DrawioViewerActions.EDIT]=new DrawioViewerButton({label:mxResources.get("diagramly.reader.edit"),icon:e.options.imagePath+"/edit.png",url:e.options.editUrl,enabled:a,linkButton:true});d[DrawioViewerActions.REMOVE]=new DrawioViewerButton({label:mxResources.get("diagramly.reader.remove"),icon:e.options.imagePath+"/remove.png",clickHandler:function(){if(confirm(mxResources.get("diagramly.reader.confirmDelete"))){window.location.href=e.options.removeUrl}},enabled:b});d[DrawioViewerActions.ACTUAL_SIZE]=new DrawioViewerButton({label:mxResources.get("diagramly.reader.zoomActual"),icon:e.options.imagePath+"/zoomActual.png",clickHandler:function(){e.graph.zoomActual();e.translateOrigin()},enabled:c});d[DrawioViewerActions.ZOOM_TO_FIT]=new DrawioViewerButton({label:mxResources.get("diagramly.reader.fit"),icon:e.options.imagePath+"/zoomFit.gif",clickHandler:function(){e.graph.fit()},enabled:c});d[DrawioViewerActions.ZOOM_OUT]=new DrawioViewerButton({label:mxResources.get("diagramly.reader.zoomOut"),icon:e.options.imagePath+"/zoomOut.gif",clickHandler:function(){e.graph.zoomOut()},enabled:c});d[DrawioViewerActions.ZOOM_IN]=new DrawioViewerButton({label:mxResources.get("diagramly.reader.zoomIn"),icon:e.options.imagePath+"/zoomIn.gif",clickHandler:function(){e.graph.zoomIn()},enabled:c});d[DrawioViewerActions.EXPAND]=new DrawioViewerButton({label:mxResources.get("diagramly.reader.fullScreen"),icon:e.options.imagePath+"/largeView.png",clickHandler:function(){var l=e.graph.view.getScale();e.graph.view.setScale(1);var k=e.graph.getGraphBounds();e.graph.view.setScale(l);var h={width:AJS.$(window).width()*0.9,height:AJS.$(window).height()*0.9};var g={};g.width=window.screen.availWidth;g.height=window.screen.availHeight-95;var f=new AJS.Dialog({width:g.width,height:g.height,id:e.id,closeOnOutsideClick:true});f.addHeader(e.filename,"drawio-reader-popup-header");var i=f.getPage(0);i.menu.css({display:"none"});e.options.width=g.width;e.options.height=g.height;e.options.autoSize=false;AJS.$(i.body.get(0)).css({position:"relative"});var j=new DrawioViewer(e.diagramName,e.id,e.ceoId,e.options);j.buttons[DrawioViewerActions.EXPAND].visible=false;j.buttons[DrawioViewerActions.CLOSE].visible=true;j.popupWindow=f;j.show(i.body.get(0));f.show()},enabled:c});d[DrawioViewerActions.CLOSE]=new DrawioViewerButton({label:mxResources.get("diagramly.reader.closeFullScreen"),icon:e.options.imagePath+"/closeLargeView.gif",clickHandler:function(){e.popupWindow.remove()},enabled:c,visible:false});return d};DrawioViewerActions={EDIT:"edit",REMOVE:"remove",ACTUAL_SIZE:"actualSize",ZOOM_TO_FIT:"zoomToFit",ZOOM_OUT:"zoomOut",ZOOM_IN:"zoomIn",EXPAND:"expand",CLOSE:"close"};function DrawioViewerButton(a){this.label=a.label;this.clickHandler=a.clickHandler;this.enabled=typeof a.enabled!="undefined"?a.enabled:true;this.icon=a.icon;this.visible=typeof a.visible!="undefined"?a.visible:true;this.linkButton=typeof a.linkButton!="undefined"?a.linkButton:false;this.url=a.url}DrawioViewerButton.prototype.label=null;DrawioViewerButton.prototype.clickHandler=null;DrawioViewerButton.prototype.enabled=true;DrawioViewerButton.prototype.icon=null;DrawioViewerButton.prototype.visible=true;DrawioViewerButton.prototype.linkButton=false;DrawioViewerButton.prototype.url=null;